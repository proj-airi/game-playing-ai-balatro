# 小丑牌 AI 检测系统

## 功能特性

### 🎯 自动窗口检测
- 使用 `pyobjc` 自动检测小丑牌游戏窗口
- 无需手动选择区域，自动定位游戏界面
- 支持窗口移动后的自动重新检测

### 🖱️ 自动点击功能
- 使用 `pynput` 实现自动点击第一张牌
- 可配置点击冷却时间，避免过于频繁的点击
- 智能识别卡牌类型，优先点击最左边的牌

### 🔍 实时检测
- 基于 YOLO 模型的实时对象检测
- 支持单次检测和连续检测模式
- 可调节检测参数（置信度、IoU阈值等）

## 使用方法

### 1. 启动程序
```bash
cd apps
python app.py
```

### 2. 配置选项
程序启动时会询问以下配置：

1. **自动点击设置**: 是否启用自动点击第一张牌
2. **点击冷却时间**: 两次点击之间的间隔时间（默认1秒）
3. **检测参数**: 置信度阈值（默认0.5）
4. **运行模式**: 
   - 单次检测：每次手动触发检测
   - 连续检测：实时检测（默认2FPS）

### 3. 控制键
连续检测模式下的控制键：
- `q`: 退出程序
- `s`: 保存当前检测结果
- `+/-`: 调整置信度阈值
- `空格`: 暂停/继续检测
- `c`: 手动触发点击第一张牌（仅在启用自动点击时可用）

**注意**: 连续检测模式下不会自动点击，需要手动按 `c` 键来触发点击，这样可以更好地控制点击时机。

## 文件说明

- `app.py`: 主程序，集成了窗口检测和自动点击功能
- `screen_capture.py`: 屏幕捕捉模块，支持自动窗口检测
- `yolo_detector.py`: YOLO检测模块
- `test_window_detection.py`: 窗口检测功能测试脚本

## 依赖要求

主要依赖已在 `pixi.toml` 中配置：
- `pyobjc`: macOS 窗口检测
- `pynput`: 自动点击功能
- `ultralytics`: YOLO 模型
- `opencv-python`: 图像处理
- `mss`: 屏幕捕捉

## 故障排除

### 窗口检测失败
如果自动检测失败，请检查：
1. 小丑牌游戏是否已启动
2. 游戏窗口是否可见且未被遮挡
3. 窗口标题是否包含 'Balatro' 关键词

### 自动点击不工作
如果自动点击功能异常：
1. 检查是否已启用自动点击功能
2. 确认检测到了卡牌对象
3. 检查点击冷却时间设置

### 检测精度问题
如果检测结果不准确：
1. 调整置信度阈值（按 +/- 键）
2. 确保游戏界面清晰可见
3. 检查模型文件是否正确加载

## 测试功能

运行测试脚本检查窗口检测功能：
```bash
python test_window_detection.py
```

## 作者

RainbowBird
